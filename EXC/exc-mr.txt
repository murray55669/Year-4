alias x-rn="hadoop jar /opt/hadoop/hadoop-2.7.1/share/hadoop/tools/lib/hadoop-streaming-2.7.1.jar"

Task 1 code begin
#MAPPER#1-mapper.py
#!/usr/bin/python

import sys

for line in sys.stdin:
    line = line.strip()

    print(line.lower())
#REDUCER#
#<none>
#TO RUN#
x-rn -input /data/assignments/ex1/webLarge.txt -output /user/$USER/data/output-1 -mapper 1-mapper.py -file 1-mapper.py 
Task 1 code end
Task 1 results begin
Task 1 results end

Task 2 code begin
#MAPPER#2-mapper.py
#!/usr/bin/python

import sys

for line in sys.stdin:
    line = line.strip()

    print(line)
#REDUCER#2-reducer.py
#!/usr/bin/python

import sys

prev_line = ""
line = ""
first_line = 1;

for line in sys.stdin:
    line = line.strip()

    if first_line:
        print line
        prev_line = line
        first_line = 0
    else:
        if line == prev_line:
            pass
        else:
            print line
            prev_line = line
#TO RUN#
x-rn -input /user/$USER/data/output-1/part-00000 -output /user/$USER/data/output-2 -mapper 2-mapper.py -reducer 2-reducer.py -file 2-mapper.py -file 2-reducer.py
Task 2 code end
Task 2 results begin
Task 2 results end

Task 3 code begin
#MAPPER#3-mapper.py
#!/usr/bin/python

import sys

for line in sys.stdin:                  # input from standard input
    line = line.strip()                 # remove whitespaces

    print(line)
#REDUCER#3-reducer.py
#!/usr/bin/python

import sys

word_count = 0
line_count = 0

for line in sys.stdin:
    line = line.strip()

    no_spaces = line.split()
    for word in no_spaces:
        word_count += 1
    
    line_count += 1
    
print str(line_count)+" "+str(word_count)
#TO RUN#
x-rn -input /user/$USER/data/output-2/part-00000 -output /user/$USER/data/output-3 -mapper 3-mapper.py -reducer 3-reducer.py -file 3-mapper.py -file 3-reducer.py
Task 3 code end
Task 3 results begin
Task 3 results end

Task 4 code begin
#MAPPER#4-mapper.py
#!/usr/bin/python

import sys

for line in sys.stdin:
    line = line.strip()
    tokens = line.split()

    for i in range(0, len(tokens)-1):
        print("{0}\t{1}\t{2}".format(tokens[i], tokens[i+1], 1))
#REDUCER#4-reducer.py
#!/usr/bin/python

import sys

prev_word_1 = ""
prev_word_2 = ""
value_total = 0
word_1 = ""
word_2 = ""

for line in sys.stdin:
    line = line.strip()
    word_1, word_2, value = line.split("\t", 2)
    value = int(value)
    if prev_word_1 == word_1 and prev_word_2 == word_2:
        value_total += value
    else:
        if prev_word_1 and prev_word_2:
            print("{0}\t{1}\t{2}".format(prev_word_1, prev_word_2, value_total))
            
        value_total = value
        prev_word_1 = word_1
        prev_word_2 = word_2

if prev_word_1 == word_1 and prev_word_2 == word_2:
    print("{0}\t{1}\t{2}".format(prev_word_1, prev_word_2, value_total))
#TO RUN#
x-rn -input /user/$USER/data/output-2/part-00000 -output /user/$USER/data/output-4 -mapper 4-mapper.py -reducer 4-reducer.py -file 4-mapper.py -file 4-reducer.py -jobconf stream.num.map.output.key.fields=2
Task 4 code end
Task 4 results begin
Task 4 results end

Task 5 code begin
#MAPPER#5-mapper.py
#!/usr/bin/python

import sys

counts = {}

for line in sys.stdin:
    line = line.strip()
    tokens = line.split()

    for i in range(0, len(tokens)-1):
        tuple = (tokens[i], tokens[i+1])
        if not counts:
            counts[tuple] = 1
        else:
            if tuple in counts:
                counts[tuple] += 1
            else:
                counts[tuple] = 1
                
    for (key_1, key_2) in counts:
        value = counts.get((key_1, key_2))
        print("{0}\t{1}\t{2}".format(key_1, key_2, value))
    counts.clear()
#REDUCER#5-reducer.py
#!/usr/bin/python

import sys

prev_word_1 = ""
prev_word_2 = ""
value_total = 0
word_1 = ""
word_2 = ""

for line in sys.stdin:
    line = line.strip()
    word_1, word_2, value = line.split("\t", 2)
    value = int(value)
    if prev_word_1 == word_1 and prev_word_2 == word_2:
        value_total += value
    else:
        if prev_word_1 and prev_word_2:
            print("{0}\t{1}\t{2}".format(prev_word_1, prev_word_2, value_total))
            
        value_total = value
        prev_word_1 = word_1
        prev_word_2 = word_2

if prev_word_1 == word_1 and prev_word_2 == word_2:
    print("{0}\t{1}\t{2}".format(prev_word_1, prev_word_2, value_total))
#TO RUN#
x-rn -input /user/$USER/data/output-2/part-00000 -output /user/$USER/data/output-5 -mapper 5-mapper.py -reducer 5-reducer.py -file 5-mapper.py -file 5-reducer.py
Task 5 code end
Task 5 results begin
Task 5 results end

Task 6 code begin
#MAPPER#6-mapper.py
#!/usr/bin/env python

import sys

for line in sys.stdin:
    line = line.strip()
    
    word_1, word_2, value = line.split("\t", 2)
    
    print("{0}\t{1}\t{2}".format(value, word_1, word_2))
#REDUCER#6-reducer.py
#!/usr/bin/env python

import sys

for line in sys.stdin:
    line = line.strip()
    
    print(line)
#TO RUN#
x-rn -D mapred.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator -D  mapred.text.key.comparator.options=-nr -input /user/$USER/data/output-4/part-00000 -output /user/$USER/data/output-6 -mapper 6-mapper.py -reducer 6-reducer.py -file 6-mapper.py -file 6-reducer.py 
Task 6 code end
Task 6 results begin
Task 6 results end

Task 7 code begin
#MAPPER#7-mapper.py
#REDUCER#7-reducer.py
#TO RUN#
Task 7 code end
Task 7 results begin
Task 7 results end

Task 8 code begin
#MAPPER#8-mapper.py
#REDUCER#8-reducer.py
#TO RUN#
Task 8 code end
Task 8 results begin
Task 8 results end

Task 9 code begin
#MAPPER#9-mapper.py
#REDUCER#9-reducer.py
#TO RUN#
Task 9 code end
Task 9 results begin
Task 9 results end

